"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[274],{2274:(s,e,t)=>{t.d(e,{A:()=>p});var i=t(7451),a=t(2492),n=t(4223),r=t(7739),o=t(3824),h=t(6801),l=t(7664),c=t(1212);function u(s,e,t){var i;return(e="symbol"==typeof(i=function(s,e){if("object"!=typeof s||!s)return s;var t=s[Symbol.toPrimitive];if(void 0!==t){var i=t.call(s,"string");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(s)}(e))?i:i+"")in s?Object.defineProperty(s,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):s[e]=t,s}const p=new class{constructor(){u(this,"$businessPurchase",null),u(this,"$countryContainerBusiness",null),u(this,"$countryContainerPersonal",null),u(this,"$countryContent",null),u(this,"$coupon",null),u(this,"$couponButton",null),u(this,"$couponValue",null),u(this,"$couponVisible",null),u(this,"$couponInvisible",null),u(this,"$useCoupon",null),u(this,"$discount",null),u(this,"$form",null),u(this,"$modal",null),u(this,"$nextButton",null),u(this,"$originalAmount",null),u(this,"$overlayContent",null),u(this,"$paymentMethod",null),u(this,"$postalCode",null),u(this,"$product",null),u(this,"$purchaseForm",null),u(this,"$screenWrap",null),u(this,"$steps",null),u(this,"$subTotal",null),u(this,"$taxAmount",null),u(this,"$taxName",null),u(this,"$total",null),u(this,"$basicVisible",null),u(this,"$professionalVisible",null),u(this,"$reverseChargeInvisible",null),u(this,"$reverseChargeVisible",null),u(this,"cardElement",null),u(this,"coupon",null),u(this,"creator",null),u(this,"currentProduct",null),u(this,"fontSize",0),u(this,"hasScriptsLoaded",!1),u(this,"isAnimating",!1),u(this,"isBusinessPurchase",!1),u(this,"isFreeLogo",!1),u(this,"isReverseCharge",!1),u(this,"isScrollable",null),u(this,"isValidCard",!1),u(this,"logoID",null),u(this,"newLogoState",null),u(this,"paymentMethod",null),u(this,"price",0),u(this,"screenIndex",0),u(this,"screens",null),u(this,"stripe",null),u(this,"tax",null),u(this,"taxValue",0),u(this,"subTotalValue",0),u(this,"totalValue",0),a.A.ready((()=>{this.start()}))}setCreator(s){this.creator=s}getCustomerInfo(){const s={billing_details:{email:(0,a.A)("#email").value(),name:`${(0,a.A)("#first-name").value()} ${(0,a.A)("#last-name").value()}`,address:{country:(0,a.A)("#country").value(),state:(0,a.A)("#region").value()}}};return this.isBusinessPurchase&&(s.billing_details.address={line1:(0,a.A)("#street-line1").value(),line2:(0,a.A)("#street-line2").value(),city:(0,a.A)("#city").value(),postal_code:(0,a.A)("#postal-code").value(),country:(0,a.A)("#country").value(),state:(0,a.A)("#region").value()}),s}async getCoupon(){await Promise.all([r.A.waitMinimum(),(async()=>{const s=this.$coupon.value();if(this.coupon=null,this.isFreeLogo=!1,s)try{const e=await(0,n.A)(`${i.Km.DOMAIN}/api/payment/get-coupon`,{product:this.currentProduct,code:s});this.coupon=e,this.applyCoupon(e,!0)}catch(s){c.A.captureError(s),this.$discount.removeClass("active"),this.$coupon.value(""),this.$couponValue.text("")}else this.applyCoupon()})()])}applyCoupon(s,e){s&&s.success&&s.coupon&&s.coupon.success?(this.$discount.addClass("active"),this.$couponValue.text(s.coupon.discount),e&&o.A.display({type:"success",message:s.coupon.message,isInBody:!1}),/free/i.test(s.coupon.type)&&(this.isFreeLogo=!0)):(e&&o.A.display({type:"error",message:s.coupon.message,isInBody:!1}),this.$discount.removeClass("active"),this.$coupon.value(""),this.$couponValue.text(""),this.$useCoupon[0].checked=!1,this.$couponVisible.css({display:"none"}),this.$couponInvisible.css({display:""})),this.updateUserDetails(),this.updatePrice()}getPurchaseInfo(){return{first_name:(0,a.A)("#first-name").value(),last_name:(0,a.A)("#last-name").value(),product:this.currentProduct,code:this.$coupon.value(),tax:{business_number:(0,a.A)("#business-number").value()},company:(0,a.A)("#company").value(),logo_id:this.logoID,new_logo_state:this.logoID?null:this.newLogoState}}trackCheckout(){return new Promise((s=>{l.A.trackCheckout({id:this.logoID,name:`logo ${this.currentProduct}`,subTotal:this.subTotalValue,callback:({trackedEvent:e})=>{s()}})}))}async submitPayment(){let s=null;return await this.trackCheckout(),await Promise.all([r.A.waitMinimum(),(async()=>{try{if(this.isFreeLogo)s=await this.submitFreePayment();else switch(this.paymentMethod.toLowerCase()){case"card":s=await this.submitCardPayment();break;case"ideal":s=await this.submitIdealPayment();break;case"paypal":s=await this.submitPaypalPayment()}}catch(s){c.A.captureError(s,{})}})()]),s}reloadPage(s){s.thankYouPage?window.location.href=s.thankYouPage:window.location.href=`${window.location.href.split("?")[0]}`}async submitFreePayment(){const s=await(0,n.A)(`${i.Km.DOMAIN}/api/payment/get-intent`,{...this.getCustomerInfo(),...this.getPurchaseInfo()},{error:!0,useServerError:!0,isInBody:!1});s?s.success?(await r.A.waitMinimum(),this.reloadPage(s)):(o.A.display({type:"error",message:"something went wrong"}),this.$modal.trigger("close")):c.A.captureError("no result")}async submitPaypalPayment(){return await(0,n.A)(`${i.Km.DOMAIN}/api/payment/get-intent`,{...this.getCustomerInfo(),...this.getPurchaseInfo(),payment_type:"paypal"},{error:!0,useServerError:!0,isInBody:!1})}async submitCardPayment(){const s=await this.stripe.createToken(this.cardElement),e=s.token;if(s&&s.error)return void o.A.display({type:"error",message:s.error.message?s.error.message:"something went wrong",isInBody:!1});const t=await(0,n.A)(`${i.Km.DOMAIN}/api/payment/get-intent`,{...this.getCustomerInfo(),...this.getPurchaseInfo(),payment_type:"card",source:e.id},{error:!0,useServerError:!0,isInBody:!1});if(t)if(t.success)try{const s=await this.stripe.handleCardPayment(t.paymentIntentSecret,this.cardElement,{payment_method_data:this.getCustomerInfo()});s.error?(o.A.display({type:"error",message:s.error.message||"something went wrong",isInBody:!0}),this.$modal.trigger("close")):(await Promise.all([r.A.waitMinimum()]),this.reloadPage(t))}catch(s){o.A.display({type:"error",message:"something went wrong",isInBody:!0}),this.$modal.trigger("close")}else o.A.display({type:"error",message:"something went wrong",isInBody:!0}),this.$modal.trigger("close");else c.A.captureError("no result")}async submitIdealPayment(){const s=(0,a.A)("#bank");return await(0,n.A)(`${i.Km.DOMAIN}/api/payment/get-intent`,{...this.getCustomerInfo(),...this.getPurchaseInfo(),payment_type:"ideal",ideal_bank:s.value()},{error:!0,useServerError:!0,isInBody:!1})}loadScripts(s=[]){return Promise.all(s.map((s=>new Promise(((e,t)=>{(0,a.A)("<script>").appendTo((0,a.A)("head")).on("load",(s=>{e(s)})).on("error",(e=>{c.A.captureError(e,{message:"error loading script",data:{script:s}}),t(e)})).attribute("src",s)})))))}configureStripe(){this.stripe=window.Stripe(i.Km.STRIPE_PUBLIC_KEY);const s=(0,a.A)("html").attribute("lang");let e="auto";s&&(e=s.toLowerCase());const t=this.stripe.elements({locale:e});this.cardElement=t.create("card",{hidePostalCode:!0,iconStyle:"solid",style:{base:{color:"#ff3859",fontFamily:"Courier, monospace",fontWeight:600,fontSize:this.fontSize,"::placeholder":{color:"#bccbed",textTransform:"lowercase"}},invalid:{color:"#ff3859",iconColor:"#ff3859"},empty:{iconColor:"#bccbed",fontWeight:400}}});const n=(0,a.A)("#card-element");this.cardElement.mount("#card-element"),this.cardElement.on("change",(s=>{this.isValidCard=s.complete,n.parent().removeClass("has-error"),this.isValidScreen(this.screenIndex)})),this.$postalCode=(0,a.A)(".js-postal-code"),this.$postalCode.on("change",(()=>this.onPostalCodeChange))}onPostalCodeChange(){this.cardElement.update({value:{postalCode:this.$postalCode.value()}})}onPaymentMethodChange(){const s=this.$paymentMethod.elements.find((s=>s.checked));this.paymentMethod=s?(0,a.A)(s).value():null,this.$purchaseForm.find(".js-payment-method-screen").each((s=>{const e=(0,a.A)(s);e.data("payment-method")===this.paymentMethod?e.css({display:"block"}):e.css({display:"none"})}))}async onProductChange(){const s=this.$product.elements.find((s=>s.checked));if(!s)return;const e=(0,a.A)(s);this.currentProduct=e.value(),this.price=Number(e.data("price")),await this.getCoupon(),this.updatePrice()}onType(s){(0,a.A)(s.currentTarget).parent().removeClass("has-error")}isValidScreen(s,{highlightErrors:e=!1}={}){if(this.isFreeLogo)return this.$steps.toggleClass("valid",!0),!0;const t=this.screens[s];if((0,a.A)(t).hasClass("js-business-purchase-visible")&&!this.isBusinessPurchase)return!0;let i=!0;const n=s=>{s.data("on-type",this.onType),s.off("change",this.onType).on("change",this.onType)};if((0,a.A)(t).find("*:not(iframe) input[required], *:not(iframe) select[required]").each((s=>{const t=(0,a.A)(s);t.value()?e&&t.parent().removeClass("has-error"):(i=!1,e&&t.parent().addClass("has-error"),n(t))})),i){const t=(0,a.A)("#bank"),r=(0,a.A)("#card-element");if(3===s)if(this.paymentMethod)switch(this.paymentMethod.toLowerCase()){case"card":i=this.isValidCard,r.parent().toggleClass("has-error",!i&&e);break;case"paypal":break;case"ideal":t.value()?e&&t.parent().removeClass("has-error"):(e&&t.parent().addClass("has-error"),n(t),i=!1);break;default:i=!1}else i=!1}return this.$steps.get(s).toggleClass("valid",i),i}updateUserDetails(){this.$steps.each(((s,e)=>{(0,a.A)(s).toggleClass("active",e===this.screenIndex)}));let s="next";(this.screenIndex===this.screens.length-1||this.isScrollable)&&(this.isFreeLogo?(this.$form.attribute("novalidate","novalidate"),s="free"):(this.$form[0].removeAttribute("novalidate"),s="purchase")),this.$nextButton.text(this.$nextButton.data(`text-${s}`))}updateForm(s){this.isProcessingForm||(this.deactivateForm(),window.setTimeout((async()=>{const e=await s();e&&e.redirect||this.activateForm()}),0))}deactivateForm(){this.isProcessingForm=!0,this.$purchaseForm.removeClass("active")}activateForm(){this.isProcessingForm=!1,this.$purchaseForm.addClass("active")}getMaxHeight(){return Math.max(...this.screens.map((s=>(0,a.A)(s).height())))}onResize(){this.$purchaseForm.removeClass("is-scrollable"),this.$screenWrap.css({height:`${this.getMaxHeight()}px`});const s=this.$overlayContent[0].scrollHeight>this.$overlayContent.height();this.isScrollable=s,this.isScrollable?(this.$screenWrap.css({height:"auto"}),this.screens.forEach((s=>{(0,a.A)(s).css({opacity:1,transform:""})}))):(this.$screenWrap.css({height:`${this.getMaxHeight()}px`}),this.screens.forEach(((s,e)=>{(0,a.A)(s).css({opacity:e===this.screenIndex?1:0,transform:""})}))),this.$purchaseForm.toggleClass("is-scrollable",this.isScrollable),this.fontSize=(0,a.A)(".js-input-card").css("fontSize"),this.updateUserDetails()}onBusinessPurchaseChange(){this.isBusinessPurchase=this.$businessPurchase[0]&&this.$businessPurchase[0].checked,(0,a.A)(".js-business-purchase-visible").css({display:this.isBusinessPurchase?"":"none"}),(0,a.A)(".js-business-purchase-visible.js-reverse-charge-visible").css({display:this.isBusinessPurchase&&this.isReverseCharge?"":"none"}),(0,a.A)(".js-business-purchase-visible.js-reverse-charge-invisible").css({display:this.isBusinessPurchase&&!this.isReverseCharge?"":"none"}),this.isBusinessPurchase?this.$countryContainerBusiness.empty().append(this.$countryContent[0]):this.$countryContainerPersonal.empty().append(this.$countryContent[0]),this.isScrollable||this.onResize()}onBeforeShow(){this.screenIndex=0,this.onBusinessPurchaseChange(),this.onPaymentMethodChange(),this.onResize(),this.updateUserDetails(),this.screens.forEach(((s,e)=>{(0,a.A)(s).toggleClass("active",e===this.screenIndex)}))}async addToCart(){this.logoID&&await(0,n.A)(`${i.Km.DOMAIN}/api/cart/add`,{logoID:this.logoID})}async onShow(){if(!(0,a.A)(".js-cart").hasClass("active")&&this.logoID&&(0,a.A)(".js-navigation").addClass("active"),l.A.trackAddToCart({id:this.logoID,name:"logo single"}),this.creator&&(this.newLogoState=JSON.stringify(this.creator.logo.getState())),!this.hasScriptsLoaded)try{await Promise.all([r.A.waitMinimum(),this.addToCart(),this.loadScripts(["https://js.stripe.com/v3/"])]),this.hasScriptsLoaded=!0,this.configureStripe(),this.activateForm()}catch(s){c.A.captureError(s),o.A.display({type:"error",message:"error loading purchase api",isInBody:!1})}}async onNextScreen(s){if(s.preventDefault(),s.stopPropagation(),this.isAnimating)return;let e=null;const t=this.isScrollable?this.screens.length-1:this.screenIndex;for(let s=0;s<=t;s++)this.isValidScreen(s,{highlightErrors:!0})||null===e&&(e=s);if(null!==e){const s=e!==this.screenIndex;return await this.toScreen(e),s&&await h.A.delay(.15),void this.wiggle()}if(t===this.screens.length-1)return void this.updateForm(this.submitPayment.bind(this));let i=this.screenIndex+1;if(!this.isBusinessPurchase)for(;(0,a.A)(this.screens[i]).hasClass("js-business-purchase-visible");)i+=1;this.toScreen(i)}async toScreen(s){if(s===this.screenIndex||this.isAnimating||this.isScrollable)return;this.isAnimating=!0;const e=(0,a.A)(this.screens[this.screenIndex]),t=(0,a.A)(this.screens[s]),n=s>this.screenIndex;this.screens.forEach((s=>{(0,a.A)(s).removeClass("active").find("input, select").attribute("tabIndex",-1)})),this.screenIndex=s,this.updateUserDetails(),await new h.A((s=>{e.css({opacity:1-s.value,transform:`translate3d(${8*(n?-s.value:s.value)}rem, 0, 0)`}),t.css({opacity:s.value,transform:`translate3d(${8*(n?1-s.value:-1+s.value)}rem, 0, 0)`})}),.25).easing(i.Ux.IN_OUT_LONG).finish();const r=t.addClass("active").find("input, select").attribute("tabIndex",1).get(0);r&&r[0].focus(),this.isAnimating=!1}onClose(){this.logoID&&(0,a.A)(".js-cart").addClass("active"),l.A.trackRemoveFromCart({id:this.logoID,name:"logo single"})}async calculateTaxes(){this.tax=null;try{let s=null;if(await Promise.all([r.A.waitMinimum(),new Promise((async(e,t)=>{try{s=await(0,n.A)(`${i.Km.DOMAIN}/api/payment/calculate-taxes`,{...this.getCustomerInfo(),tax:{business_number:(0,a.A)("#business-number").value()}}),e()}catch(s){t(s)}}))]),!s||!s.tax)throw new Error("no tax result");this.tax=s}catch(s){c.A.captureError(s)}this.updatePrice()}updatePrice(){let s=this.price,e=this.$taxName.data("tax-name"),t=0,i=0;this.$taxName.text(e),this.$taxAmount.text(t),this.$subTotal.text("…"),this.taxValue=0,this.subTotalValue=0,this.totalValue=0,this.coupon&&(s=this.coupon.amount),this.$originalAmount.text(this.price),this.isReverseCharge=!1,this.tax&&(/reverse charge/i.test(this.tax.tax?.notes)?(t=0,s=Number(s/1.21),this.taxValue=0,this.isReverseCharge=!0):this.tax.tax.name?(i=Number(this.tax.tax.rate||0),e=`${this.tax.tax.name} (${i}%)`,t=s-s/Number(1+i/100),this.taxValue=t):(t=0,this.taxValue=t)),this.subTotalValue=(s-Number(t)).toFixed(2),this.totalValue=s.toFixed(2),this.$subTotal.text(this.subTotalValue),this.$taxName.text(`${e}:`),this.$taxAmount.text(!isNaN(parseFloat(t))&&isFinite(t)?t.toFixed(2):t),this.$total.text(this.totalValue),this.$reverseChargeVisible.css({display:this.isReverseCharge?"":"none"}),this.$reverseChargeInvisible.css({display:this.isReverseCharge?"none":""});const a=/^basic/i.test(this.currentProduct);this.$basicVisible.css({display:a?"":"none"}),this.$professionalVisible.css({display:a?"none":""})}async start(){this.$modal=(0,a.A)(".js-modal-purchase"),this.$overlayContent=(0,a.A)(".js-overlay-scrollable"),this.$modal.length&&(this.$modal.data("on-before-show",(()=>this.onBeforeShow())),this.$modal.data("on-show",(()=>this.onShow())),this.$modal.data("on-close",(()=>this.onClose())),this.$businessPurchase=(0,a.A)(".js-business-purchase"),this.$countryContent=(0,a.A)(".js-country-content"),this.$countryContainerBusiness=(0,a.A)(".js-country-container-business"),this.$countryContainerPersonal=(0,a.A)(".js-country-container-personal"),this.$purchaseForm=(0,a.A)(".js-purchase-form"),this.$form=(0,a.A)(".js-payment-form"),this.$paymentMethod=this.$purchaseForm.find(".js-payment-method"),this.$steps=this.$purchaseForm.find(".js-purchase-form__steps > li"),this.$screenWrap=this.$purchaseForm.find(".js-purchase-form__screen-wrap"),this.screens=this.$purchaseForm.find(".js-purchase-form__screen").elements,this.$nextButton=this.$purchaseForm.find(".js-next-button"),this.$product=this.$purchaseForm.find(".js-product"),this.$coupon=this.$purchaseForm.find(".js-coupon"),this.$couponButton=this.$purchaseForm.find(".js-coupon-button"),this.$couponValue=this.$purchaseForm.find(".js-coupon-value"),this.$originalAmount=this.$purchaseForm.find(".js-original-amount"),this.$discount=this.$purchaseForm.find(".js-discount"),this.$subTotal=this.$purchaseForm.find(".js-subtotal"),this.$taxName=this.$purchaseForm.find(".js-tax-name"),this.$taxAmount=this.$purchaseForm.find(".js-tax-amount"),this.$total=this.$purchaseForm.find(".js-total"),this.$basicVisible=this.$purchaseForm.find(".js-basic-visible"),this.$professionalVisible=this.$purchaseForm.find(".js-professional-visible"),this.$reverseChargeVisible=this.$purchaseForm.find(".js-reverse-charge-visible"),this.$reverseChargeInvisible=this.$purchaseForm.find(".js-reverse-charge-invisible"),this.$purchaseForm.on("change",(()=>{this.isValidScreen(this.screenIndex)})),this.$steps.each(((s,e)=>{(0,a.A)(s).on("click",(s=>{s.preventDefault(),s.stopPropagation(),this.isScrollable||(this.isValidScreen(this.screenIndex,{highlightErrors:!0}),this.toScreen(e))}))})),this.$businessPurchase.on("change",(s=>this.onBusinessPurchaseChange(s))),this.$product.on("change",(s=>this.onProductChange(s))),this.$paymentMethod.on("change",(s=>this.onPaymentMethodChange(s))),this.$nextButton.on("click",(s=>this.onNextScreen(s))),this.$couponButton.on("click",(()=>this.updateForm(this.getCoupon.bind(this)))),this.$purchaseForm.find(".js-change-tax").each((s=>{const e=(0,a.A)(s);/select/i.test(s.nodeName)?e.on("change",(()=>this.calculateTaxes())):e.on("blur",(()=>this.calculateTaxes()))})),this.logoID=this.$purchaseForm.data("logo-id"),this.$couponVisible=this.$purchaseForm.find(".js-coupon-visible"),this.$couponInvisible=this.$purchaseForm.find(".js-coupon-invisible"),this.$useCoupon=this.$purchaseForm.find(".js-use-coupon"),this.$couponVisible.css({display:"none"}),this.$useCoupon.on("click",(()=>{this.$couponInvisible.css({display:"none"}),this.$couponVisible.css({display:""})})),(0,a.A)(window).on("resize",(()=>{this.onResize()})),this.onProductChange(),this.isValidScreen(this.screenIndex))}wiggle(){new h.A((s=>{this.$screenWrap.css({transform:`translate3d(${.5*Math.sin(2*Math.PI*-2*s.value)}rem, 0, 0)`})}),.65).easing(i.Ux.IN_OUT).onComplete((()=>{this.$screenWrap.css({transform:""})})).start()}}}}]);